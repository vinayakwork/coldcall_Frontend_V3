<!DOCTYPE html>
<html>
<head>
  <title>Cold Call Generator</title>

  <!-- Markdown Renderer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    body {
      background-color: white;
      color: black;
      font-family: Arial, sans-serif;
      padding: 40px;
    }

    input {
      width: 400px;
      padding: 8px;
      background: white;
      color:black;
      border: 1px solid;
    }

    button {
      padding: 8px 12px;
      margin-right: 10px;
      background: white;
      color: black;
      border: 1px solid ;
      cursor: pointer;
    }

    button:hover {
      background: black;
      color: white;
    }

    .output {
      margin-top: 25px;
      line-height: 1.7;
      font-size: 14px;
    }

    .output h3 {
      margin-top: 20px;
      color: black;
    }

    .output ul {
      margin-left: 20px;
    }

    .output strong {
      font-weight: 600;
      color: #b2ffff;
    }

    .output hr {
      border: none;
      border-top: 1px solid black;
      margin: 20px 0;
    }
  </style>
</head>

<body>

<h2>Company Analyzer</h2>

<input id="url" placeholder="Enter company URL" />
<br><br>

<button onclick="analyze()">Analyze Company</button>
<button onclick="showCondense()" id="condenseBtn" style="display:none;">
  Condense Fit
</button>
<button onclick="showSales()" id="SalesBtn" style="display:none;">
  Sales Guidance
</button>

<div id="output" class="output"></div>

<script>
let apiResponse = null;
const cache = {};
const BACKEND_URL = "https://coldcall-backend-v3.vercel.app/analyze";

async function analyze() {
  const url = document.getElementById("url").value.trim();
  if (!url) return;

  document.getElementById("output").innerHTML = "<em>Analyzing...</em>";
  document.getElementById("condenseBtn").style.display = "none";
  document.getElementById("SalesBtn").style.display = "none";

  if (cache[url]) {
    apiResponse = cache[url];
    showCompany();
    return;
  }

  const res = await fetch(BACKEND_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ url })
  });

  apiResponse = await res.json();
  cache[url] = apiResponse;

  showCompany();
}

function showCompany() {
  const text =
    apiResponse.result?.company_analysis || "No company analysis";

  document.getElementById("output").innerHTML =
    marked.parse(text);

  document.getElementById("condenseBtn").style.display = "inline-block";
  document.getElementById("SalesBtn").style.display = "none";
}

function showCondense() {
  const text =
    apiResponse.result?.condense_analysis || "No condense analysis";

  document.getElementById("output").innerHTML =
    marked.parse(text);

  document.getElementById("SalesBtn").style.display = "inline-block";
}

function showSales() {
  const text =
    apiResponse.result?.sales_guidance || "No sales guidance";

  document.getElementById("output").innerHTML =
    marked.parse(text);
}
</script>

</body>
</html>
